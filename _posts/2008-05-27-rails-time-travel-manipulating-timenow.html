--- 
name: rails-time-travel-manipulating-timenow
layout: post
title: "Rails Time Travel: Manipulating Time.now for Tests"
time: 2008-05-27 07:37:00.005000 Z
categories: 
- Programming
- Tutorials
- Ruby
- rails
---
<blockquote>Can we go anywhere we want at any time?<br />You can do anything you want.<br /></blockquote><br /><br /><div style="border: 2px solid green">Check out the <a href="http://blog.springenwerk.com/2008/10/rails-time-travel-revisited.html">new version about time travel with RSpec!</a><br /></div><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_-dK4R3d1lbc/SDu6mEjFkgI/AAAAAAAAAec/xUgS4JFUd-k/s1600-h/timetunnel.jpg"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer;" src="http://3.bp.blogspot.com/_-dK4R3d1lbc/SDu6mEjFkgI/AAAAAAAAAec/xUgS4JFUd-k/s320/timetunnel.jpg" alt="" id="BLOGGER_PHOTO_ID_5204958957575442946" border="0" /></a>Do you have code in your Ruby on Rails models that depends on the current date and time? I do. And I want to test it to make sure it works right. In my case a certain date is only valid if it is in the current month or in the previous month but only if it's not the 11th day of the month yet. If today were the 10th of May - for example - a date in April would be valid. If today were the 11th of May, a date in April wouldn't be valid anymore, though.<br />Just testing this piece of code if the day the tests are being run happens to be below the 11th day of the month is not a solution, of course. So I googled a bit and found <a href="http://snippets.dzone.com/posts/show/1738#comment-1101">this wonderful piece of code</a>.<br /><br />These are the steps to get your Rails Time Machine (tm) up and running:<br /><ol><li>Copy the above code to a file and save it as test/time_helper.rb</li><li>Require it in your test:<br /><pre class="prettyprint">require File.dirname(__FILE__) + '/../time_helper'</pre></li><li>Either set the time for all the tests in the file:<br /><pre class="prettyprint"><br />def setup<br />pretend_now_is(Time.local(2007, 8, 1))  # position *all* tests back in time!<br />end<br /><br />def teardown<br />Time.reset    # jump back to the present<br />end<br /></pre><br />or just do some time travel for a code block:<br /><pre class="prettyprint"><br />def test_decades<br />pretend_now_is(Time.local(1960)) do<br />  assert_equal(1960, Time.now.year)<br />end<br />pretend_now_is(Time.local(1970)) do<br />  assert_equal(1970, Time.now.year)<br />end<br /># ...<br />end<br /></pre>(These code samples come <a href="http://snippets.dzone.com/posts/show/1738#comment-1101">from here</a>. Thank you!)</li><li>Find a street where your <a href="http://en.wikipedia.org/wiki/De_Lorean_time_machine">De Lorean</a> can reach 88 mph and run your time traveling tests!</li></ol>Please give my regards to <a href="http://youtube.com/watch?v=xrGWooNDPiE">Bill and Ted</a> if you meet them.<br /><br />If this was useful for you, please take a minute and recommend me:<br/><a href="http://workingwithrails.com/recommendation/new/person/11816-johannes-fahrenkrug"><img alt="Recommend Me" src="http://workingwithrails.com/images/tools/compact-small-button.jpg" /></a><br/>Thank you!<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/4366452231084261097-8323196241979627726?l=blog.springenwerk.com' alt='' /></div>
