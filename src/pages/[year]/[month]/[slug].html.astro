---
import { getCollection } from "astro:content";

export async function getStaticPaths() {
    const allPosts = await getCollection("archived_post");

    return allPosts.map((post) => {
        const slug = post.data.name
        const postDate = post.data.time
        const year = String(postDate.getFullYear())
        const month = String(postDate.getMonth() + 1).padStart(2, '0');

        return {
            params: { month, year, slug }
        }
    });
}

const { year, month, slug } = Astro.params;

// Redirect to the URL without .html suffix
return Astro.redirect(`/${year}/${month}/${slug}`, 301);
---